# Rat Pay Pentest Scripts

This directory contains automated scripts for security testing the `rat-pay-minikube` instance.
The scripts are designed to be run from a machine that has network access to the `rat-pay-minikube` instance (e.g., the `pentest` EC2 instance created via Terraform) or your local machine if you have VPN/direct access.

## Prerequisites

1. **Target IP**: You need the Private IP (if running from `pentest` instance) or Public IP (if running locally) of the `rat-pay-minikube` instance.
2. **SSH Key**: You need the private key (`rat-pay.pem`) to authenticate with the target for Host and K8s audits.
3. **Permissions**: Ensure scripts are executable:
   ```bash
   chmod +x *.sh
   ```

## Scripts

### 1. Network-Level Security Testing (`1_network_security.sh`)

Performs external network scanning and validation.

**Usage:**
```bash
./1_network_security.sh <TARGET_IP>
```

**Checks:**
- **Map Internal Network**: Uses `nmap` to find open ports and identify services.
- **Firewall Validation**: Uses `nmap` ACK scan to check firewall rules.
- **TLS/SSL Testing**: Uses `sslscan` to check for weak ciphers on port 443.
- **DNS Audit**: Checks for open DNS ports and resolution.

---

### 2. Host-Level Security Testing (`2_host_security.sh`)

Connects to the target via SSH and runs local security checks on the Minikube node (Ubuntu OS).

**Usage:**
```bash
./2_host_security.sh <TARGET_IP> <PATH_TO_PRIVATE_KEY>
```
*Example: `./2_host_security.sh 10.0.1.5 ../rat-pay.pem`*

**Checks:**
- **OS Vulnerabilities**: Checks for upgradable packages with security updates.
- **Authentication**: Audits SSH configuration (`/etc/ssh/sshd_config`).
- **Privilege Escalation**: Looks for SUID binaries and checks `sudo` privileges.
- **Logging**: Verifies `syslog` or `journald` are active.

---

### 3. Kubernetes Security Testing (`3_k8s_security.sh`)

Connects to the target via SSH and runs Kubernetes-specific security audits.

**Usage:**
```bash
./3_k8s_security.sh <TARGET_IP> <PATH_TO_PRIVATE_KEY>
```

**Checks:**
- **API Server Access**: Checks for anonymous access to K8s API.
- **Kubelet Security**: Checks for anonymous access to Kubelet API.
- **Pod Security**: Scans for privileged pods.
- **CIS Benchmark**: Downloads and runs `kube-bench` to audit the cluster against CIS benchmarks.

## Notes

- Some tools (like `kube-bench`) are downloaded/installed on the target during the script execution.
- Ensure the target has internet access to download these tools.
- The `pentest` EC2 instance is configured in the same subnet to facilitate these tests.
